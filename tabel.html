<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Orders</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Custom CSS for responsiveness */
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            padding: 20px;
        }

        .btn {
            margin-top: 10px;
        }

        .table {
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .table {
                font-size: 14px;
            }

            .table-responsive {
                overflow-x: auto;
            }

            .table td, .table th {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .btn-edit, .btn-delete {
                font-size: 12px;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Semua Pesanan</h1>
        <a href="index.html" class="btn btn-primary">Kembali ke Halaman Utama</a>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Nama Pelanggan</th>
                    <th>Tanggal Pemesanan</th>
                    <th>Metode Pembayaran</th>
                    <th>Status Pembayaran</th>
                    <th>Detail Pesanan</th>
                    <th>Total</th>
                    <th>Edit</th>
                    <th>Hapus</th>
                </tr>
            </thead>
            <tbody id="ordersTableBody">
                <!-- Orders will be dynamically generated here -->
            </tbody>
        </table>
    </div>
</div>

<script>
    function loadOrders() {
        const orders = JSON.parse(localStorage.getItem('allOrders')) || [];
        const ordersTableBody = document.getElementById('ordersTableBody');
        ordersTableBody.innerHTML = '';

        orders.forEach((order, index) => {
            let orderDetails = '';
            let total = 0;

            order.order.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                orderDetails += `${item.name} x ${item.quantity} = Rp ${itemTotal}<br>`;
            });

            // Convert date format from YYYY-MM-DD to DD-MM-YYYY
            const [year, month, day] = order.orderDate.split('-');
            const formattedDate = `${day}-${month}-${year}`;

            ordersTableBody.innerHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${order.customerName}</td>
                    <td>${formattedDate}</td>
                    <td>${order.paymentMethod}</td>
                    <td id="paymentStatus-${index}">${order.paymentStatus}</td>
                    <td id="orderDetails-${index}">${orderDetails}</td>
                    <td id="total-${index}">Rp ${total}</td>
                    <td><button class="btn btn-sm btn-primary" onclick="editOrder(${index})">Edit</button></td>
                    <td><button class="btn btn-sm btn-danger" onclick="deleteOrder(${index})">Hapus</button></td>
                </tr>
            `;
        });
    }

    function editOrder(index) {
        const orders = JSON.parse(localStorage.getItem('allOrders')) || [];
        const order = orders[index];

        // Prompt user to edit the selected order
        const newCustomerName = prompt("Nama Pelanggan:", order.customerName);
        const newOrderDate = prompt("Tanggal Pemesanan:", order.orderDate);
        const newPaymentMethod = prompt("Metode Pembayaran:", order.paymentMethod);
        const newPaymentStatus = prompt("Status Pembayaran:", order.paymentStatus);

        // Update the order data if the user didn't cancel
        if (newCustomerName !== null && newOrderDate !== null && newPaymentMethod !== null && newPaymentStatus !== null) {
            order.customerName = newCustomerName;
            order.orderDate = newOrderDate;
            order.paymentMethod = newPaymentMethod;
            order.paymentStatus = newPaymentStatus;

            // Update order details, payment status, and total in the table
            let newOrderDetails = '';
            let newTotal = 0;
            order.order.forEach(item => {
                const itemTotal = item.price * item.quantity;
                newTotal += itemTotal;
                newOrderDetails += `${item.name} x ${item.quantity} = Rp ${itemTotal}<br>`;
            });
            document.getElementById(`orderDetails-${index}`).innerHTML = newOrderDetails;
            document.getElementById(`paymentStatus-${index}`).innerText = newPaymentStatus;
            document.getElementById(`total-${index}`).innerText = `Rp ${newTotal}`;

            // Save the updated order to localStorage
            orders[index] = order;
            localStorage.setItem('allOrders', JSON.stringify(orders));
        }
    }

    function deleteOrder(index) {
        const confirmDelete = confirm("Apakah Anda yakin ingin menghapus pesanan ini?");
        if (confirmDelete) {
            const orders = JSON.parse(localStorage.getItem('allOrders')) || [];
            orders.splice(index, 1);
            localStorage.setItem('allOrders', JSON.stringify(orders));
            loadOrders();
        }
    }

    document.addEventListener('DOMContentLoaded', loadOrders);
</script>

<script>
    function loadOrders() {
        fetch('php/get_orders.php')
            .then(response => response.json())
            .then(orders => {
                const ordersTableBody = document.getElementById('ordersTableBody');
                ordersTableBody.innerHTML = '';
    
                orders.forEach((order, index) => {
                    let orderDetails = '';
                    let total = 0;
    
                    order.order.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        total += itemTotal;
                        orderDetails += `${item.name} x ${item.quantity} = Rp ${itemTotal}<br>`;
                    });
    
                    const [year, month, day] = order.orderDate.split('-');
                    const formattedDate = `${day}-${month}-${year}`;
    
                    ordersTableBody.innerHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${order.customerName}</td>
                            <td>${formattedDate}</td>
                            <td>${order.paymentMethod}</td>
                            <td id="paymentStatus-${index}">${order.paymentStatus}</td>
                            <td id="orderDetails-${index}">${orderDetails}</td>
                            <td id="total-${index}">Rp ${total}</td>
                            <td><button class="btn btn-sm btn-primary" onclick="editOrder(${index})">Edit</button></td>
                            <td><button class="btn btn-sm btn-danger" onclick="deleteOrder(${index})">Hapus</button></td>
                        </tr>
                    `;
                });
            })
            .catch(error => {
                console.error('Error loading orders:', error);
            });
    }
</script>

<!-- Skrip JavaScript di bagian bawah halaman -->

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js


</body>
</html>

